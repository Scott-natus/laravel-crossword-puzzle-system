# 작업 방법론 (WORKFLOW)

## 0. 개발 환경 이해

### 원격 개발 환경
- **서버**: 222.100.103.227 (SSH 접속)
- **개발 방식**: SSH로 원격 서버에 직접 연결하여 작업
- **포트 구성**:
  - Laravel (게시판/관리 페이지): 80 포트
  - React 프론트엔드: 3000 포트
  - React API: 5050 포트

### 데이터베이스 접속
- **호스트**: 127.0.0.1 (서버 내부에서 같은 서버의 DB 접근)
- **접속 명령**: `PGPASSWORD=tngkrrhk psql -h 127.0.0.1 -U myuser -d mydb`

## 1. 변경/개발 전
- 반드시 전체 백업(DB, 소스) 실시
- 변경/추가 작업은 단계별로 진행, 중간 점검 필수
- DB 변경은 쿼리/SQL을 사전 검토 및 승인 후 실행

## 2. 개발/운영
- React/Laravel 분리 개발, API 연동
- 퍼즐/힌트/레벨 등 주요 데이터는 요구사항에 맞게 일괄 처리
- 대량 작업은 artisan 명령어 또는 스케줄러로 자동화
- 장애 발생 시 즉시 원인 파악 및 롤백/복구

## 3. 배포/운영
- 배포 전 최종 백업
- 배포 후 주요 기능 정상 동작 확인
- 장애/이슈 발생 시 docs/TROUBLESHOOTING.md에 기록

## 4. 문서화
- 모든 변경/이슈/해결 내역은 docs/ 폴더에 기록

## 1. 문제 해결 접근법

### 데이터베이스 접속 문제 발생 시
```
1. 즉시 환경 설정 확인: cat .env
2. 올바른 접속 정보로 재시도
3. 불필요한 중간 단계 건너뛰기
```

### 코드 변경 시
```
1. 문제 분석 → 관련 코드 확인 → 해결책 제안 → 실행
2. 변경 후 실제 동작 테스트
3. docs/ 폴더에 변경사항 기록
```

### 로그 시스템 문제 발생 시
```
1. config/logging.php 설정 확인
2. 모든 로그 채널이 NullHandler로 설정되지 않았는지 확인
3. php artisan config:clear 실행
4. tail -f storage/logs/laravel.log로 실시간 로그 확인
```

## 2. 데이터베이스 작업 원칙

### 스키마 변경 시 (매우 중요!)
- **변경 전 필수 절차**:
  1. 데이터에 미치는 영향 분석 및 상세 설명
  2. 사용자에게 변경 작업 진행 여부 확인
  3. 백업 진행 여부 확인
  4. 사용자 승인 후 진행
- **변경 중**:
  - `/var/www/html/puzzle_db_schema.sql`에 변경사항 추가
  - 단계별 진행 상황 보고
- **변경 후**:
  - 데이터 무결성 확인
  - 서비스 정상 동작 확인

### 데이터 조작 작업 규칙 (매우 중요!)
- **대화형 진행 필수**: INSERT, UPDATE, DELETE, TRUNCATE, DROP 작업 시 반드시 사용자와 대화형으로 진행
- **작업 전 확인 절차**:
  1. 실행할 SQL 문을 먼저 보여주기
  2. 예상 결과와 영향 범위 설명
  3. 사용자 승인 요청
  4. 승인 후에만 실행
- **단계별 진행**: 복잡한 작업은 단계별로 나누어 진행
- **실행 후 확인**: 작업 완료 후 결과 확인 및 보고

### 데이터 확인 시
- PostgreSQL 접속: `PGPASSWORD=tngkrrhk psql -h 127.0.0.1 -U myuser -d mydb`
- 테이블 구조: `\d table_name`
- 제약조건 확인: 체크 제약조건, 유니크 제약조건 등

## 3. 라이브 서버 작업 주의사항 (222.100.103.227 전용)

### Laravel 파일 수정 시
- 서비스 영향도 분석 후 진행
- React 기능과의 연동 고려
- 변경 후 즉시 테스트

### React 기능 추가/수정 시
- Laravel 서비스에 미치는 영향 분석
- API 엔드포인트 변경 시 Laravel 측 영향 고려
- 포트 충돌 여부 확인 (3000, 5050 포트)

## 4. UI/UX 개선 작업

### 페이지네이션
- Laravel 기본 `links()` 대신 Bootstrap 커스텀 페이지네이션 사용
- 서버사이드 필터링/검색 구현 (클라이언트사이드 JavaScript 대신)

### 정렬 기능
- 서버사이드 정렬 구현
- 컨트롤러에서 GET 파라미터 처리

### 네비게이션
- 전역 드롭다운 메뉴 활용
- 관리자 전용 링크는 조건부 표시

### 게시판 시스템 관리
- 각 게시판별 글쓰기 버튼은 현재 URL의 boardType 파라미터를 직접 읽어 생성
- AppServiceProvider에서 전역 변수 공유 시 주의 (boardType 등)
- 레이아웃에서 동적 링크 생성 시 현재 컨텍스트 확인
- 게시판 타입별 올바른 글쓰기 페이지로 이동하는지 확인

### 그리드 템플릿 시스템 관리
- 그리드 템플릿 저장 시 사용자가 "단어 위치 정보"에서 선택한 번호가 그대로 저장됨
- PuzzleGridTemplateService의 saveTemplate()에서 sortWordPositionsWithPriority() 호출 제거
- 사용자 입력 번호 우선 보존, 자동 넘버링 비활성화
- 템플릿 수정 시 기존 번호 정보 유지

## 5. API 최적화

### Gemini API 사용
- 개별 호출 대신 일괄 처리
- 정규식으로 응답 파싱
- 에러 처리 및 재시도 로직

## 6. 코드 품질 관리

### 모델-컨트롤러-뷰 일관성
- 컬럼명 통일 (예: `content` → `hint_text`)
- 유효성 검사 규칙 표준화
- 에러 메시지 일관성 유지

### JavaScript 중복 로드 방지
- Vite와 CDN 중복 로드 확인
- 불필요한 스크립트 태그 제거

### 로그 시스템 관리
- 로그 설정은 config/logging.php에서 관리
- 모든 로그 채널이 NullHandler로 설정되지 않도록 주의
- 디버깅 로그는 \Log::info() 사용하여 기록
- 로그 레벨은 env('LOG_LEVEL', 'debug')로 설정
- 설정 변경 후 반드시 php artisan config:clear 실행

## 7. 백업 및 복구

### 자동 백업 시스템
- 데이터베이스: `pg_dump`
- 소스코드: `tar.gz` 압축
- 2일 이상 된 백업 자동 삭제

### 수동 백업
- 중요한 변경 전 반드시 백업
- `backups/` 폴더에 저장

## 8. 테스트 및 검증

### 변경 후 확인사항
- 페이지 로딩 확인
- 기능 동작 테스트
- 데이터베이스 무결성 확인
- 에러 로그 확인

### 게시판 기능 테스트
- 각 게시판별 글쓰기 버튼이 올바른 페이지로 이동하는지 확인
- 게시판 타입별 URL 파라미터 정상 전달 확인
- 로그 시스템 정상 동작 확인

### 그리드 템플릿 기능 테스트
- 사용자가 선택한 번호가 정확히 저장되는지 확인
- 템플릿 수정 시 기존 번호 정보가 유지되는지 확인
- 자동 넘버링이 비활성화되어 있는지 확인

## 9. 문서화 원칙

### 모든 변경사항 기록
- `docs/` 폴더에 상세 기록
- 문제 해결 과정 문서화
- 향후 참고용 가이드 작성

### 커밋 메시지
- 명확하고 구체적인 설명
- 변경 이유와 영향 범위 포함

### 작업 내용 저장 규칙
- 작업 완료 후 다음 4개 파일에 내용 반영:
  1. .cursorrules (프로젝트 루트)
  2. docs/WORKFLOW.md (작업 방법론)
  3. docs/DATABASE_SCHEMA.md (DB 스키마)
  4. docs/TROUBLESHOOTING.md (문제 해결 가이드)
- Git 커밋 및 GitHub 푸시 포함

## 10. 언어 및 소통

### 모든 설명은 한글로
- 기술 용어도 한글로 설명
- 사용자와의 소통은 한글 우선
- 문서화도 한글로 진행 